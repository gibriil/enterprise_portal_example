<IfModule auth_openidc_module>
    OIDCProviderMetadataURL http://keycloak:8080/realms/myportal/.well-known/openid-configuration
    OIDCClientID enterprise-portal-client-id
    OIDCClientSecret enterprise-portal-client-secret
    OIDCCryptoPassphrase a-random-secret-used-by-apache-oidc

    OIDCRedirectURI http://localhost/.oidc
    OIDCDefaultLoggedOutURL http://localhost/
    OIDCLogoutRequestParams "redirect_uri=http://localhost&client_id=enterprise-portal-client-id&prompt=none"

    OIDCRemoteUserClaim email
    # OIDCPassClaimsAs environment
    OIDCClaimPrefix OIDC_CLAIM_
    OIDCScope "openid email profile"

    OIDCCookieDomain localhost
    OIDCCookiePath /
    OIDCCookieHTTPOnly On
    OIDCCookieSameSite Lax

    # Session handling
    OIDCSessionType server-cache
    OIDCSessionInactivityTimeout 3600
    OIDCSessionMaxDuration 28800
    OIDCCacheType shm
</IfModule>

<VirtualHost *:8080>
    ServerName localhost
    # Reverse proxy Keycloak paths
    ProxyPreserveHost On
    <Proxy "http://keycloak:8080/">
        Require all granted
    </Proxy>
    ProxyPass / http://keycloak:8080/
    ProxyPassReverse / http://keycloak:8080/
</VirtualHost>

<Location /.oidc>
        AuthType openid-connect
        Require valid-user
</Location>